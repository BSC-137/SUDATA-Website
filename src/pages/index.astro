---
import Layout from '../layouts/Layout.astro';
import NetworkLogo from '../components/NetworkLogo.jsx';

// USU member count — set USU_MEMBER_COUNT in Vercel env vars to update
const usuMembers = parseInt(import.meta.env.USU_MEMBER_COUNT || '680');

// Instagram follower count — fetched from Instagram Graph API at build time
// Token expires every 60 days: refresh at graph.instagram.com/refresh_access_token
let igFollowers = 4294;
try {
	const token = import.meta.env.INSTAGRAM_ACCESS_TOKEN;
	const userId = import.meta.env.INSTAGRAM_USER_ID;
	if (token && userId) {
		const res = await fetch(
			`https://graph.instagram.com/v21.0/${userId}?fields=followers_count&access_token=${token}`
		);
		if (res.ok) {
			const data = await res.json();
			igFollowers = data.followers_count ?? igFollowers;
		}
	}
} catch {
	// silently fall back to default
}
---

<Layout title="SUDATA | Data Science Society">
	<div class="flex flex-col items-center justify-center min-h-[50vh] text-center space-y-8 sm:space-y-12 pt-24 sm:pt-32 pb-16 sm:pb-24">
		<div class="w-full h-[250px] sm:h-[350px] md:h-[400px] mb-8 sm:mb-12 md:mb-16 relative z-10 px-4">
			<NetworkLogo client:only="react" />
		</div>
		
		<!-- Headline: Solid Electric Blue, Neon Tube Glow -->
		<h1 class="reveal-on-scroll text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-sudata-neon tracking-wider sm:tracking-widest mb-6 sm:mb-8 md:mb-12 neon-text-shadow px-4">
			Data is the DNA of the Modern World
		</h1>
		
		<div class="reveal-on-scroll max-w-3xl mx-auto mb-24 sm:mb-32 md:mb-48 px-4 sm:px-6">
			<p class="text-base sm:text-lg md:text-xl lg:text-2xl text-sudata-grey font-mono-tech leading-relaxed border-l-2 border-sudata-neon pl-4 sm:pl-6 md:pl-8 text-left">
				<span class="text-sudata-neon font-bold animate-flicker">&gt;_</span> At SUDATA, we believe understanding data isn't just about grades—it's about navigating the information age. We welcome students of ANY discipline to join us, so long as you want to know a little more about data.
			</p>
		</div>
		
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12 md:gap-16 w-full max-w-[90rem] px-4 sm:px-6 md:px-8">
			<!-- Card 1: Hub -->
			<div class="reveal-on-scroll group glass-panel-3d p-6 sm:p-8 md:p-12 flex flex-col items-start text-left h-full relative overflow-hidden scanline-overlay">
				
				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 font-mono-tech text-sudata-neon text-xs sm:text-sm tracking-[0.2em] opacity-80">
					[ 01_HUB ]
				</div>
				
				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 text-sudata-neon text-4xl sm:text-5xl md:text-6xl font-mono neon-icon-glow flex justify-center w-full">
					<span class="font-mono text-white/50 mr-2 sm:mr-4 md:mr-6 text-5xl sm:text-6xl md:text-7xl">[</span>
                    <!-- Pixel Brain SVG (Custom 32x32 Grid - "brain" missing in pixelarticons v1.8.1) -->
					<svg width="64" height="64" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon sm:w-20 sm:h-20 md:w-24 md:h-24" style="filter: drop-shadow(0 0 10px #00F0FF);">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M10 6H22V8H24V10H26V18H24V22H20V24H14V26H10V22H8V18H6V10H8V8H10V6ZM12 10H14V12H12V10ZM18 10H20V12H18V10ZM22 14H24V16H22V14ZM8 14H10V16H8V14ZM12 18H14V20H12V18ZM18 18H20V20H18V18Z" fill="#00F0FF"/>
                    </svg>
                    <span class="font-mono text-white/50 ml-2 sm:ml-4 md:ml-6 text-5xl sm:text-6xl md:text-7xl">]</span>
				</div>
				
				<h2 class="relative z-10 text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 sm:mb-5 md:mb-6 tracking-wider sm:tracking-widest group-hover:text-sudata-neon transition-colors">
					The Hub
				</h2>
				<p class="relative z-10 text-sm sm:text-base font-mono-tech text-sudata-grey/90 leading-relaxed">
					Share and learn data-related knowledge. From Python scripts to neural networks, we cover it all.
				</p>
			</div>
			
			<!-- Card 2: Collective -->
			<div class="reveal-on-scroll group glass-panel-3d p-6 sm:p-8 md:p-12 flex flex-col items-start text-left h-full relative overflow-hidden delay-100 scanline-overlay">

				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 font-mono-tech text-sudata-neon text-xs sm:text-sm tracking-[0.2em] opacity-80">
					[ 02_COLLECTIVE ]
				</div>

				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 text-sudata-neon text-4xl sm:text-5xl md:text-6xl font-mono neon-icon-glow flex justify-center w-full">
					<span class="font-mono text-white/50 mr-2 sm:mr-4 md:mr-6 text-5xl sm:text-6xl md:text-7xl">[</span>
                    <!-- Pixel Users SVG (pixelarticons) -->
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon sm:w-20 sm:h-20 md:w-24 md:h-24" style="filter: drop-shadow(0 0 10px #00F0FF);">
                        <path d="M11 0H5v2H3v6h2v2h6V8H5V2h6V0zm0 2h2v6h-2V2zM0 14h2v4h12v2H0v-6zm2 0h12v-2H2v2zm14 0h-2v6h2v-6zM15 0h4v2h-4V0zm4 8h-4v2h4V8zm0-6h2v6h-2V2zm5 12h-2v4h-4v2h6v-6zm-6-2h4v2h-4v-2z" fill="#00F0FF"/>
                    </svg>
					<span class="font-mono text-white/50 ml-2 sm:ml-4 md:ml-6 text-5xl sm:text-6xl md:text-7xl">]</span>
				</div>
				<h2 class="relative z-10 text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 sm:mb-5 md:mb-6 tracking-wider sm:tracking-widest group-hover:text-sudata-neon transition-colors">
					The Collective
				</h2>
				<p class="relative z-10 text-sm sm:text-base font-mono-tech text-sudata-grey/90 leading-relaxed">
					Hang out with savvy people and make friends. Collaboration is key in the data world.
				</p>
			</div>

			<!-- Card 3: Blast -->
			<div class="reveal-on-scroll group glass-panel-3d p-6 sm:p-8 md:p-12 flex flex-col items-start text-left h-full relative overflow-hidden delay-200 scanline-overlay">

				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 font-mono-tech text-sudata-neon text-xs sm:text-sm tracking-[0.2em] opacity-80">
					[ 03_BLAST ]
				</div>

				<div class="relative z-10 mb-6 sm:mb-8 md:mb-10 text-sudata-neon text-4xl sm:text-5xl md:text-6xl font-mono neon-icon-glow flex justify-center w-full">
					<span class="font-mono text-white/50 mr-2 sm:mr-4 md:mr-6 text-5xl sm:text-6xl md:text-7xl">[</span>
                    <!-- Pixel Zap SVG (pixelarticons) -->
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon sm:w-20 sm:h-20 md:w-24 md:h-24" style="filter: drop-shadow(0 0 10px #00F0FF);">
                        <path d="M12 1h2v8h8v4h-2v-2h-8V5h-2V3h2V1zM8 7V5h2v2H8zM6 9V7h2v2H6zm-2 2V9h2v2H4zm10 8v2h-2v2h-2v-8H2v-4h2v2h8v6h2zm2-2v2h-2v-2h2zm2-2v2h-2v-2h2zm0 0h2v-2h-2v2z" fill="#00F0FF"/>
                    </svg>
					<span class="font-mono text-white/50 ml-2 sm:ml-4 md:ml-6 text-5xl sm:text-6xl md:text-7xl">]</span>
				</div>
				<h2 class="relative z-10 text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 sm:mb-5 md:mb-6 tracking-wider sm:tracking-widest group-hover:text-sudata-neon transition-colors">
					The Blast
				</h2>
				<p class="relative z-10 text-sm sm:text-base font-mono-tech text-sudata-grey/90 leading-relaxed">
					Have fun while exploring the info-rich world. Hackathons, workshops, and more.
				</p>
			</div>
		</div>

		<!-- CTA Section -->
		<div class="reveal-on-scroll mt-32 sm:mt-48 md:mt-64 w-full max-w-5xl text-center space-y-12 sm:space-y-16 md:space-y-20 mb-24 sm:mb-32 md:mb-48 px-4">
			<h3 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-bold text-white font-mono-tech tracking-wider sm:tracking-widest flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4">
				<span>Why not join us if you want to hang out with other savvy people like yourself?</span>
                <!-- Pixel Link SVG (pixelarticons) -->
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon inline-block sm:w-10 sm:h-10 md:w-12 md:h-12" style="image-rendering: pixelated; filter: drop-shadow(0 0 5px #00F0FF);">
                    <path d="M4 6h7v2H4v8h7v2H2V6h2zm16 0h-7v2h7v8h-7v2h9V6h-2zm-3 5H7v2h10v-2z" fill="#00F0FF"/>
                </svg>
			</h3>

			<!-- Stats Row -->
			<div id="stats-section" class="flex flex-col sm:flex-row items-center justify-center gap-8 sm:gap-12 md:gap-16 lg:gap-24">
				<!-- USU Members -->
				<div class="flex flex-col items-center gap-2">
					<div class="flex items-end gap-2">
						<span id="usu-count" class="text-5xl md:text-6xl font-bold text-sudata-neon font-mono neon-text-shadow tabular-nums" data-target={usuMembers}>0</span>
						<span class="text-sudata-neon text-3xl font-mono mb-1">+</span>
					</div>
					<div class="font-mono-tech text-sudata-grey/70 text-sm tracking-[0.15em] uppercase flex items-center gap-2">
						<!-- Pixel Briefcase -->
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon/70">
							<path d="M8 3h8v4h6v14H2V7h6V3zm2 4h4V5h-4v2zM4 9v10h16V9H4z" fill="currentColor"/>
						</svg>
						USU Members
					</div>
				</div>

				<!-- Divider -->
				<div class="hidden sm:block w-px h-16 bg-white/10"></div>

				<!-- Instagram Followers -->
				<div class="flex flex-col items-center gap-2">
					<div class="flex items-end gap-2">
						<span id="ig-count" class="text-5xl md:text-6xl font-bold text-sudata-neon font-mono neon-text-shadow tabular-nums" data-target={igFollowers}>0</span>
						<span class="text-sudata-neon text-3xl font-mono mb-1">+</span>
					</div>
					<div class="font-mono-tech text-sudata-grey/70 text-sm tracking-[0.15em] uppercase flex items-center gap-2">
						<!-- Pixel Instagram -->
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon/70">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M7 2H17V4H19V6H21V18H19V20H17V22H7V20H5V18H3V6H5V4H7V2ZM7 4H5V6H7V4ZM17 4H19V6H17V4ZM19 18V6H21V18H19ZM17 20V18H19V20H17ZM7 20H17V18H7V20ZM5 18V20H7V18H5ZM5 6V18H3V6H5ZM9 8H15V10H17V14H15V16H9V14H7V10H9V8ZM11 10H13V14H11V10ZM17 6H19V8H17V6Z" fill="currentColor"/>
						</svg>
						Instagram Followers
					</div>
				</div>
			</div>
			
			<div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-8 md:gap-12 lg:gap-16 w-full">
				<a href="https://usu.edu.au/clubs/sydney-uni-data-society/" target="_blank" rel="noopener noreferrer" 
				   class="group relative inline-flex items-center justify-center px-6 sm:px-10 md:px-14 py-4 sm:py-5 md:py-7 font-mono-tech font-bold text-white text-sm sm:text-base md:text-lg transition-all duration-300 border border-white/30 hover:border-sudata-neon/80 bg-transparent rounded-xl overflow-hidden btn-scanline w-full sm:w-auto">
					<div class="absolute inset-0 bg-sudata-neon/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out"></div>
					<span class="relative flex items-center gap-2 sm:gap-3 md:gap-4 group-hover:tracking-wider transition-all duration-300">
						Official USU Membership 
                        <!-- Pixel Briefcase SVG (pixelarticons) -->
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-neon animate-pulse sm:w-6 sm:h-6" style="image-rendering: pixelated; filter: drop-shadow(0 0 5px #00F0FF);">
                            <path d="M8 3h8v4h6v14H2V7h6V3zm2 4h4V5h-4v2zM4 9v10h16V9H4z" fill="#00F0FF"/>
                        </svg>
					</span>
				</a>

				<a href="https://www.instagram.com/usyd.sudata/" target="_blank" rel="noopener noreferrer"
				   class="group relative inline-flex items-center justify-center px-6 sm:px-10 md:px-14 py-4 sm:py-5 md:py-7 font-mono-tech font-bold text-sudata-navy text-sm sm:text-base md:text-lg transition-all duration-300 bg-sudata-neon hover:bg-[#70FFFF] rounded-xl shadow-[0_0_20px_rgba(0,240,255,0.6)] hover:shadow-[0_0_50px_rgba(0,240,255,1)] btn-scanline hover:-translate-y-1 w-full sm:w-auto">
					<span class="relative flex items-center gap-2 sm:gap-3 md:gap-4">
						Follow the Gram 
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sudata-navy sm:w-6 sm:h-6" style="image-rendering: pixelated;">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M7 2H17V4H19V6H21V18H19V20H17V22H7V20H5V18H3V6H5V4H7V2ZM7 4H5V6H7V4ZM17 4H19V6H17V4ZM19 18V6H21V18H19ZM17 20V18H19V20H17ZM7 20H17V18H7V20ZM5 18V20H7V18H5ZM5 6V18H3V6H5ZM9 8H15V10H17V14H15V16H9V14H7V10H9V8ZM11 10H13V14H11V10ZM17 6H19V8H17V6Z" fill="#020617"/>
                        </svg>
					</span>
				</a>
			</div>
		</div>
	</div>
</Layout>

<script>
	// ── Count-up animation triggered by IntersectionObserver ──────────────
	function animateCount(el: HTMLElement, target: number, duration: number = 1200) {
		let start = 0;
		const startTime = performance.now();

		function step(currentTime: number) {
			const elapsed = currentTime - startTime;
			const progress = Math.min(elapsed / duration, 1);
			// Ease-out cubic
			const eased = 1 - Math.pow(1 - progress, 3);
			const current = Math.floor(eased * target);
			el.textContent = current.toLocaleString();
			if (progress < 1) {
				requestAnimationFrame(step);
			} else {
				el.textContent = target.toLocaleString();
			}
		}

		requestAnimationFrame(step);
	}

	const statsSection = document.getElementById('stats-section');
	const usuEl = document.getElementById('usu-count') as HTMLElement;
	const igEl = document.getElementById('ig-count') as HTMLElement;

	if (statsSection && usuEl && igEl) {
		const statsObserver = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					const usuTarget = parseInt(usuEl.dataset.target || '599');
					const igTarget = parseInt(igEl.dataset.target || '4251');
					animateCount(usuEl, usuTarget, 1400);
					animateCount(igEl, igTarget, 1600);
				}
			});
		}, { threshold: 0.3 });

		statsObserver.observe(statsSection);
	}
</script>
